<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"global.html":{"id":"global.html","title":"Global","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Global Members &lt;constant&gt; config :Object Configuration for Metaviews application. This includes selectors, defaults, and other constants specific to Metaviews Type: Object &lt;constant&gt; config :Object Configuration for Massviews application. This includes selectors, defaults, and other constants specific to Massviews Type: Object &lt;constant&gt; config :Object Configuration for Langviews application. This includes selectors, defaults, and other constants specific to Langviews Type: Object &lt;constant&gt; config :Object Configuration for Topviews application. This includes selectors, defaults, and other constants specific to Topviews Type: Object &lt;constant&gt; config :Object Configuration for Pageviews application. This includes selectors, defaults, and other constants specific to Pageviews Type: Object &lt;constant&gt; config :Object Configuration for Redirectviews application. This includes selectors, defaults, and other constants specific to Redirectviews Type: Object &lt;constant&gt; config :Object Configuration for Siteviews application. This includes selectors, defaults, and other constants specific to Siteviews Type: Object &lt;constant&gt; siteMap :Object Sitematrix of all supported WMF wikis Type: Object &lt;constant&gt; templates :Object Templates used by Chart.js. Functions used within our app must be in the global scope. All quotations must be double-quotes or properly escaped. Type: Object &lt;constant&gt; templates :Object Templates used by Chart.js. Functions used within our app must be in the global scope. All quotations must be double-quotes or properly escaped. Type: Object Methods ChartHelpers(superclass) Shared chart-specific logic, used in all apps except Topviews Parameters: Name Type Description superclass class base class Returns: class extending superclass Type null ListHelpers(superclass) Shared list-specific logic Parameters: Name Type Description superclass class base class Returns: class extending superclass Type null undefinedassignOutputDataChartOpts() Prepare chart options before showing chart view, based on current chart type undefinedbuildChartData(datasets, labels) Get data formatted for Chart.js and the legend templates Parameters: Name Type Description datasets Array as retrieved by getPageViewsData labels Array corresponding labels for the datasets Returns: ready for chart rendering Type object undefineddestroyChart() Destroy previous chart, if needed. undefinedexportCSV() Exports current chart data to CSV format and loads it in a new tab With the prepended data:text/csv this should cause the browser to download the data undefinedexportJSON() Exports current lang data to JSON format and loads it in a new tab undefinedexportJSON() Exports current chart data to JSON format and loads it in a new tab undefinedexportPNG() Exports current data as PNG image, opening it in a new tab undefinedfillInZeros(items, startDate, endDate) Fills in zeros to a timeseries, see: https://wikitech.wikimedia.org/wiki/Analytics/AQS/Pageview_API#Gotchas Parameters: Name Type Description items object entries fetched from Pageviews API startDate moment start date of range to filter through endDate moment end date of range Returns: 0 = dataset with zeros where nulls were, 1 = dates that met the edge case, meaning data is not yet available Type array undefinedfillInZeros(data, startDate, endDate) Fills in zero values to a timeseries, see: https://wikitech.wikimedia.org/wiki/Analytics/AQS/Pageview_API#Gotchas Parameters: Name Type Description data object fetched from API startDate moment start date of range to filter through endDate moment end date of range Returns: dataset with zeros where nulls where Type object undefinedgetApiUrl(entity, startDate, endDate) Get url to query the API based on app and options Parameters: Name Type Description entity String name of entity we're querying for (page name or project name) startDate moment start date endDate moment end date Returns: the URL Type String undefinedgetCacheKey() Return cache key for current params Returns: key Type String undefinedgetPageViewsData(entities) Mother function for querying the API and processing data Parameters: Name Type Description entities Array list of page names, or projects for Siteviews Returns: Promise resolving with pageviews data and errors, if present Type Deferred undefinedgetPageviewsURL(project, page) Link to /pageviews for given article and chosen daterange Parameters: Name Type Description project String base project, e.g. en.wikipedia.org page String page name Returns: URL FIXME: should include agent and platform, and use special ranges as currently specified Type String undefinedgetPermaLink() Get params needed to create a permanent link of visible data Returns: hash of params Type Object undefinedgetPermaLink() Get params needed to create a permanent link of visible data Returns: hash of params Type Object undefinedgetState() Get current class name of , representing the current state of the form Returns: state, one of this.config.formStates Type String undefinedisLogarithmic() Are we currently in logarithmic mode? Returns: true or false Type Boolean undefinedisLogarithmicCapable() Test if the current chart type supports a logarithmic scale Returns: log-friendly or not Type Boolean undefinedisPageviews() Are we trying to show data on pageviews (as opposed to unique devices)? Returns: true or false Type Boolean undefinedisRequestCached() Check simple storage to see if a request with the current params would be cached Returns: cached or not Type Boolean undefinedisUniqueDevices() Are we trying to show data on pageviews (as opposed to unique devices)? Returns: true or false Type Boolean undefinedprintChart() Print the chart! undefinedrenderData(cb) Render list of output data into view Parameters: Name Type Description cb function block to call between initial setup and showing the output undefinedresetView( [select2] [, clearMessages]) Removes chart, messages, and resets site selections Parameters: Name Type Argument Default Description select2 boolean &lt;optional&gt; false whether or not to clear the Select2 input clearMessages boolean &lt;optional&gt; true whether or not to clear any exisitng errors from view undefinedsetChartPointDetectionRadius() Attempt to fine-tune the pointer detection spacing based on how cluttered the chart is undefinedsetColorsAndLogValues(outputData) Set colors for each dataset based on the config for that chart type. This is because when removing entities from Select2, the only thing thing that needs doing is to set the colors based on how many entities we have This function also sets null where there are zeros if we're showing a log chart, and otherwise fills in zeros where there are nulls (due to API caveat) Parameters: Name Type Description outputData Object should be hte same as this.outputData Returns: transformed data Type Object undefinedsetInitialChartType( [numDatasets]) Set the default chart type or the one from localStorage, based on settings Parameters: Name Type Argument Default Description numDatasets Number &lt;optional&gt; 1 number of datasets undefinedsetupDateRangeSelector() sets up the daterange selector and adds listeners undefinedshouldBeLogarithmic(datasets) Determine if we should show a logarithmic chart for the given dataset, based on Theil index Parameters: Name Type Description datasets Array pageviews Returns: yes or no Type Boolean undefinedshowErrors(xhrData) Show errors built in this.processInput Parameters: Name Type Description xhrData object as built by this.processInput, like { errors: [], fatalErrors: [] } Returns: whether or not fatal errors occured Type boolean undefinedshowPointLabels(options) Show the values each point in the series Courtesy of Hung Tran: http://stackoverflow.com/a/38797712/604142 Parameters: Name Type Description options Object to be passed to Chart instantiation Returns: modified options Type Object undefinedtoggleView(view) Toggle or set chart vs list view. All of the normal chart logic lives here Parameters: Name Type Description view String which view to set, either chart or list undefinedupdateChart( [xhrData]) Update the chart with data provided by processInput() Parameters: Name Type Argument Description xhrData Object &lt;optional&gt; data as constructed by processInput() data is ommitted if we already have everything we need in this.outputData Returns: Type null undefinedupdateProgressBar(value, total) Set value of progress bar Parameters: Name Type Description value Number current iteration total Number total number of iterations Returns: Type null Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Classes Classes LangViews MassViews MetaViews MixinBuilder PageViews Pv PvConfig RedirectViews SiteViews TopViews Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Pageviews AnalysisA suite of tools to visualize pageviews data of Wikimedia Foundation wikis Live tool: https://tools.wmflabs.org/pageviews (and Langviews, Topviews, Siteviews, Massviews, Redirect Views) User documentation: https://meta.wikimedia.org/wiki/Pageviews_Analysis JavaScript documentation: https://tools.wmflabs.org/pageviews/jsdocs Metaviews (pageviews of the Pageviews apps): https://tools.wmflabs.org/pageviews/meta IE10 and Safari 8 and below are not supported. DependenciesThis guide mostly assumes you're using OSX or Linux. The setup process may differ on Windows machines. Node PHP 5.6 PHP is for rendering partials in the views and for the Intuition i18n framework. There otherwise is no backend logic. Composer ESLint and a SCSS linter* *The linters are not necessary, but preferred so your code maintains a consistent style. Setup Install all node packages and dependencies with npm install Run composer update to install all PHP dependencies Create a copy of config.sample.php named config.php, and within that file, set ROOTDIR to your project root path. Run gulp to watch the javascripts, stylesheets and views and automatically recompile when new changes are saved. NOTE: Some routing in the app uses absolute paths, hence you may wish to modify your local web server to point to localhost/pageviews as opposed to browsing directly to the PHP file. In Apache, under &lt;IfModule alias_module&gt; you can create an alias with Alias /pageviews /path/to/pageviews/public_html Alias /massviews /path/to/pageviews/public_html/massviewsand so forth for all the other apps. Code walkthroughThis app aims to be a part of the future and not linger in the past. JavaScript is written in ES6 where possible, and transpiled to ES5 with Babel. If you need to add a polyfill for something, add it to /javascript/shared/polyfills.js. All assets and views are ultimately placed in public_html. With the exception of images, you won't need to make any manual modifications to this directory. StructureThe repo contains six separate applications that share code with each other (Pageviews, Langviews, Topviews, Siteviews, Massviews and Redirect Views). The root directory of javascripts, stylesheets and views represent the Pageviews app. Other apps have a subdirectory therein. The main development asset files share the same name as the app (e.g. pageviews.js for the main JavaScript file for Pageviews). After compilation each app has it's own application.js and application.css. PHP partials and Sass imports are prepended with underscores (e.g. _footer.php, _mixins.scss). JavaScriptsBrowserify is used to help follow a module pattern. You'll need to require('./file_name') any file that is a dependency. All JavaScript is written in ES6 (and possibly ES7). Each app has it's own config.js, which are constants for application-wide use. Pageviews and Siteviews have a templates.js file that defines how data is shown in the right column on the interface. Shared JavaScript goes in the /shared directory and must be required as needed. list_helpers.js is used on apps that have a list view, which are Massviews and Langviews. All apps but Topviews show a chart of some sort, and require chart_helpers.js. When the JS files are compiled, they are concatenated into a single application.js that lives within the directory for that app inside public_html. All JavaScript is documented using JSDoc. The documentation is hosted at https://tools.wmflabs.org/pageviews/jsdocs. You can generate the docs locally by running: gulp jsdoc &amp;&amp; open jsdocs/gen/index.htmlStylesStyles are written in http://sass-lang.com/ and compiled to CSS. The CSS is then automatically vendor-prefixed to support modern browsers. Bootstrap is used as the CSS framework. Each page has it's own .scss file that imports dependencies. Shared files are simply prefixed with an underscore. _mixins.scss is for the mixins, placeholders, keyframes and colour variables. Similar to the JavaScripts, _list_view.scss is imported by apps that have a list view (Langviews, Massviews), and _chart_view.scss by apps that show charts. HamlThe views within /views are written in MtHaml and compiled to PHP files in /public_html. LocalRun gulp to simply watch for changes and automatically compile as needed. You can also run tasks by app and function, such as gulp massviews for all Massviews-related files, or gulp scripts to compile only the JavaScripts, but gulp by itself should be all you need. ProductionBefore making a pull request or pushing to master, remember to run gulp production so the assets are minified and concatenated. JSDocs are also generated, and placed in a dedicated sub-repo (not submodule) in jsdocs/gen. These can optionally be pull requested to the JSDocs repo. TestsTests will be ran automatically when you push or create a pull request. AcceptanceIt is probably easiest to create a pull request to run acceptance tests on Travis. To run the tests locally, you'll need: JDK Selenium Standalone Server Firefox IMPORTANT: The default browser Selenium uses is Firefox, and as of Firefox 47 the necessary webdriver, FirefoxDriver has been removed. A working combination is Selenium WebDriver 2.53.1 and Firefox 47.0.1 (not Firefox 47, or later versions than 47.0.1). Once installed run java -jar selenium-server-standalone-2.53.1.jar to start the selenium server and ./nightwatch to run the tests. You can run specific tests with ./nightwatch --test tests/my_test.js. If a test fails when you push to remote, check the build and there will be a link to a video of the test, along with the output of the logs. LintersThe styling of all ES6 and SCSS is enforced with linters. You can run these locally with gulp lint, and will also be ran when you run gulp production. If you need a particular rule to be ignored, you can add exceptions (see Scss-lint, Eslint). Index config.js Configuration for Pageviews application Author: MusikAnimal Copyright: 2016 MusikAnimal Index langviews/config.js Configuration for Langviews application Author: MusikAnimal Copyright: 2016 MusikAnimal Index langviews/langviews.js Main file for Langviews application Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Requires module:Pv module:ChartHelpers module:ListHelpers Index massviews/config.js Configuration for Massviews application Author: MusikAnimal Copyright: 2016 MusikAnimal Index massviews/massviews.js Main file for Massviews application Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Requires module:Pv module:ChartHelpers module:ListHelpers Index meta/config.js Configuration for Metaviews application Author: MusikAnimal Copyright: 2016 MusikAnimal Index meta/meta.js Main file for Metaviews application Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Index pageviews.js Main file for Pageviews application Author: MusikAnimal, Kaldari, Marcelrf Copyright: 2016 MusikAnimal, Kaldari, Marcelrf License: MIT License: https://opensource.org/licenses/MIT Index redirectviews/config.js Configuration for Redirectviews application Author: MusikAnimal Copyright: 2016 MusikAnimal Index redirectviews/redirectviews.js Main file for Redirectviews application Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Requires module:Pv module:ChartHelpers module:ListHelpers Index shared/chart_helpers.js Shared chart-specific logic Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Index shared/core_extensions.js Core JavaScript extensions, either to native JS or a library. Polyfills have their own file polyfills.js Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Index shared/list_helpers.js Shared list-specific logic Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Index shared/polyfills.js Polyfills for users who refuse to upgrade their browsers Most code is adapted from MDN Index shared/pv.js Shared code amongst all apps (Pageviews, Topviews, Langviews, Siteviews, Massviews, Redirect Views) Author: MusikAnimal, Kaldari Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Index shared/pv_config.js Shared config amongst all apps Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Index shared/site_map.js WMF site matrix, with some unsupported wikis removed Index siteviews/config.js Configuration for Siteviews application Author: MusikAnimal Copyright: 2016 MusikAnimal Index siteviews/siteviews.js Main file for Siteviews application Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Requires module:Pv module:ChartHelpers Index siteviews/templates.js Templates used by Chart.js for Siteviews app Author: MusikAnimal Copyright: 2016 MusikAnimal Index templates.js Templates used by Chart.js for Pageviews app Author: MusikAnimal Copyright: 2016 MusikAnimal Index topviews/config.js Configuration for Topviews application Author: MusikAnimal Copyright: 2016 MusikAnimal Index topviews/topviews.js Main file for Topviews application Author: MusikAnimal Copyright: 2016 MusikAnimal License: MIT License: https://opensource.org/licenses/MIT Requires module:Pv Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"LangViews.html":{"id":"LangViews.html","title":"Class: LangViews","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: LangViews LangViews Main LangViews class new LangViews() set instance variables and initial setup in pv.constructor Members baseProject Get the base project name (without language and the .org) outputData datasets structure: [{ title: page, items: [ { access: '', agent: '', article: '', granularity: '', project: '', timestamp: '', views: 10 } ] }] output structure: { labels: [''], listData: [ { label: '', data: [1,2,3,4], sum: 10, average: 2, index: 0 ... MERGE in this.config.chartConfig[this.chartType].dataset(this.config.colors[0]) } ], totalViewsSet: [1,2,3,4], sum: 10, average: 2, datesWithoutData: ['2016-05-16T00:00:00-00:00'] } typeahead Get the instance of the Typeahead plugin Methods assignDefaults() Copy necessary default values to class instance. Called when the view is reset. buildMotherDataset(label, link, datasets) Build our mother data set, from which we can draw a chart, render a list of data, whatever our heart desires :) Parameters: Name Type Description label string label for the dataset (e.g. category:blah, page pile 24, etc) link string HTML anchor tag for the label datasets array array of datasets for each article, as returned by the Pageviews API Returns: mother data set, also stored in this.outputData Type object exportCSV() Exports current lang data to CSV format and loads it in a new tab With the prepended data:text/csv this should cause the browser to download the data getBadgeMarkup(badgeCode) Given the badge code provided by the Wikidata API, return a image tag of the badge Parameters: Name Type Description badgeCode String as defined in this.config.badges Returns: HTML markup for the image Type String getInterwikiData(dbName, pageName) Query Wikidata to find data about a given page across all sister projects Parameters: Name Type Description dbName String database name of source project pageName String name of page we want to get data about Returns: Promise resolving with interwiki data Type Deferred getPageNameFromURL(url) Parse wiki URL for the page name Parameters: Name Type Description url String full URL to a wiki page Returns: page name Type String | null getPageViewsData(interWikiData) Loop through given interwiki data and query the pageviews API for each Also updates this.outputData with result Parameters: Name Type Description interWikiData Object as given by the getInterwikiData promise Returns: Promise resolving with data ready to be rendered to view Type Deferred getParams( [forCacheKey]) Get all user-inputted parameters Parameters: Name Type Argument Default Description forCacheKey boolean &lt;optional&gt; false whether or not to include the page name, and exclude sort and direction in the returned object. This is for the purposes of generating a unique cache key for params affecting the API queries Returns: project, platform, agent, etc. Type Object getSortProperty(item, type) Get value of given langview entry for the purposes of column sorting Parameters: Name Type Description item object langview entry within this.outputData type String type of property to get Returns: value Type String | Number initialize() Initialize the application. Called in pv.js after translations have loaded popParams() Parses the URL query string and sets all the inputs accordingly Should only be called on initial page load, until we decide to support pop states (probably never) processInput() Process the langviews for the article and options entered Called when submitting the form Returns: Type null pushParams(clear) Push relevant class properties to the query string Parameters: Name Type Default Description clear Boolean false wheter to clear the query string entirely Returns: Type null renderData() Render list of langviews into view setState(state) Helper to set a CSS class on the main node, styling the document based on a 'state' Parameters: Name Type Description state String class to be added; should be one of ['initial', 'processing', 'complete'] setupListeners() Add general event listeners setupSourceInput() Setup typeahead on the article input, killing the prevous instance if present validateProject() Calls parent setupProjectInput and updates the view if validations passed reverting to the old value if the new one is invalid Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"MassViews.html":{"id":"MassViews.html","title":"Class: MassViews","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: MassViews MassViews Main MassViews class new MassViews() set instance variables and boot the app via pv.constructor Members baseProject Get the base project name (without language and the .org) outputData datasets structure: [{ title: page, project: 'en.wikipedia.org', items: [ { access: '', agent: '', article: '', granularity: '', project: '', timestamp: '', views: 10 } ] }] output structure: { labels: [''], listData: [ { label: '', project: '', data: [1,2,3,4], sum: 10, average: 2, index: 0 ... MERGE in this.config.chartConfig[this.chartType].dataset(this.config.colors[0]) } ], totalViewsSet: [1,2,3,4], sum: 10, average: 2, datesWithoutData: ['2016-05-16T00:00:00-00:00'] } Methods apiErrorReset(apiName [, errorMessage]) Helper to reset the state of the app and indicate that than API error occurred Parameters: Name Type Argument Description apiName String name of the API where the error occurred errorMessage String &lt;optional&gt; optional error message to show retrieved from API assignDefaults() Copy necessary default values to class instance. Called when the view is reset. buildMotherDataset(label, link, datasets) Build our mother data set, from which we can draw a chart, render a list of data, whatever our heart desires :) Parameters: Name Type Description label string label for the dataset (e.g. category:blah, page pile 24, etc) link string HTML anchor tag for the label datasets array array of datasets for each article, as returned by the Pageviews API Returns: mother data set, also stored in this.outputData Type object exportCSV() Exports current mass data to CSV format and loads it in a new tab With the prepended data:text/csv this should cause the browser to download the data getPagePile(id) Get list of pages from Page Pile API given id Parameters: Name Type Description id Number PagePile ID Returns: Promise resolving with page names Type Deferred getPageURLsFromHashtagCSV(csvData) Helper for processHashtag that parses the CSV data to get the page URLs Parameters: Name Type Description csvData Array as built by processHashtag Returns: full page URLs Type Array getPageViewsData(pages [, project]) Loop through given pages and query the pageviews API for each Also updates this.outputData with result Parameters: Name Type Argument Description pages Array list of page names or full URLs to pages project String &lt;optional&gt; project such as en.wikipedia.org If null pages is assumed to be an array of page URLs Returns: Promise resolving with data ready to be rendered to view Type Deferred getParams( [forCacheKey]) Get all user-inputted parameters Parameters: Name Type Argument Default Description forCacheKey boolean &lt;optional&gt; false whether or not to include the page name, and exclude sort and direction in the returned object. This is for the purposes of generating a unique cache key for params affecting the API queries Returns: project, platform, agent, etc. Type Object getPileLink(id) Get a link to the page pile with given ID Parameters: Name Type Description id String | Number ID of the PagePile Returns: markup Type String getPileURL(id) Get a URL for the page pile with given ID Parameters: Name Type Description id String | Number ID of the PagePile Returns: the URL Type String getSortProperty(item, type) Get value of given langview entry for the purposes of column sorting Parameters: Name Type Description item object langview entry within this.outputData type String type of property to get Returns: value Type String | Number getWikiPageFromURL(url) Parse wiki URL for the wiki and page name Parameters: Name Type Description url String full URL to a wiki page Returns: ['wiki', 'page'] or null if invalid Type Array | null initialize() Initialize the application. Called in pv.js after translations have loaded mapCategoryPageNames(pages, namespaces) Get subject pages of given talk pages in given namespace Parameters: Name Type Description pages Array page names namespaces Object as returned by the siteInfo Returns: mapped page names Type Array popParams() Parses the URL query string and sets all the inputs accordingly Should only be called on initial page load, until we decide to support pop states (probably never) processCategory(project, category, cb) Get pageviews data of given category in given project Parameters: Name Type Description project String project name category String category name cb function called after processing is complete, given the label and link for the category and the pageviews data processExternalLink(cb) Process the input as the a URL pattern for an external link, getting the pageviews of results from list=exturlusage Parameters: Name Type Description cb function called after processing is complete, given the label and link for the link pattern at Special:LinkSearch and the pageviews data processHashtag(cb) Process the input as a hashtag Parameters: Name Type Description cb function called after processing is complete, given the label and link for the hashtag and the pageviews data processInput() Process the massviews for the given source and options entered Called when submitting the form Returns: Type null processPagePile(cb) Process the input as the ID of a page pile Parameters: Name Type Description cb function called after processing is complete, given the label and link for the PagePile and the pageviews data processQuarry(cb) Process the input as the ID of a Quarry dataset, getting the pageviews of results in the 'page_title' column Parameters: Name Type Description cb function called after processing is complete, given the label and link for the Quarry and the pageviews data processSubpages(project, targetPage, cb) Get pageviews for subpages of given page and project Parameters: Name Type Description project String project name targetPage String name of parent wiki page cb function called after processing is complete, given the label and link for the page and the pageviews data processTemplate(project, template, cb) Get pageviews of pages that transclude the given template for given project Parameters: Name Type Description project String template String template name, can be any wiki page cb function called after processing is complete, given the label and link for the template and the pageviews data processWikiPage(project, page, cb) Get pageviews of pages linked on the given page on given project Parameters: Name Type Description project String page String page name cb function called after processing is complete, given the label and link for the page and the pageviews data pushParams(clear) Push relevant class properties to the query string Parameters: Name Type Default Description clear Boolean false wheter to clear the query string entirely Returns: Type null renderData() Render list of massviews into view setState(state [, cb]) Helper to set a CSS class on the main node, styling the document based on a 'state' Parameters: Name Type Argument Description state String class to be added; should be one of ['initial', 'processing', 'complete'] cb function &lt;optional&gt; Optional function to be called after initial state has been set setupListeners() Add general event listeners updateSourceInput(node) Show/hide form elements based on the selected source Parameters: Name Type Description node Object HTML element of the selected source validateProject(project) Validate given project and throw an error if invalid Parameters: Name Type Description project String tha project Returns: true or false Type Boolean Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"MetaViews.html":{"id":"MetaViews.html","title":"Class: MetaViews","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: MetaViews MetaViews Main MetaViews class new MetaViews() set instance variables and boot the app via pv.constructor Methods getCircularData(data, entity, index) Get data formatted for a circular chart (Pie, Doughnut, PolarArea) Parameters: Name Type Description data object data just before we are ready to render the chart entity string title of entity (page or site) index integer where we are in the list of entities to show used for colour selection Returns: ready for chart rendering Type object getLinearData(data, entity, index) Get data formatted for a linear chart (line, bar, radar) Parameters: Name Type Description data object data just before we are ready to render the chart entity string title of entity index integer where we are in the list of entities to show used for colour selection Returns: ready for chart rendering Type object getParams( [specialRange]) Get all user-inputted parameters except the tools Parameters: Name Type Argument Default Description specialRange boolean &lt;optional&gt; true whether or not to include the special range instead of start/end, if applicable Returns: platform, agent, etc. Type Object getSortProperty(item, type) Get value of given page for the purposes of column sorting in table view Parameters: Name Type Description item object page name type String type of property to get Returns: value Type String | Number initialize() Initialize the application. Called in pv.js after translations have loaded popParams() Parses the URL query string and sets all the inputs accordingly Should only be called on initial page load, until we decide to support pop states (probably never) processInput(force) Query the API for each tool, building up the datasets and then calling renderData Parameters: Name Type Description force boolean whether to force the chart to re-render, even if no params have changed Returns: Type null pushParams() Push relevant class properties to the query string Called whenever we go to update the chart setSelect2Defaults(items) Directly set items in Select2 Parameters: Name Type Description items array page titles Returns: untouched array of items Type array setupListeners() General place to add page-wide listeners setupSelect2() Sets up the tool selector and adds listener to update chart showSingleAppLegend() Show info below the chart when there is only one app being queried updateTable() Update the page comparison table, shown below the chart Returns: Type null Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"MixinBuilder.html":{"id":"MixinBuilder.html","title":"Class: MixinBuilder","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: MixinBuilder MixinBuilder new MixinBuilder(superclass) set super class instance variable Parameters: Name Type Description superclass class Methods with(mixins) blend given classes with current superclass Parameters: Name Type Argument Description mixins class &lt;repeatable&gt; Returns: classes Type Array Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"PageViews.html":{"id":"PageViews.html","title":"Class: PageViews","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: PageViews PageViews Main PageViews class new PageViews() Set instance variables and boot the app via pv.constructor Members project This ajax call queries the Mediawiki API for article name suggestions given the search term inputed in the selector. We ultimately want to make the endpoint configurable based on whether they want redirects specialRange let's us know if we've gotten the page info from API yet Methods getArticleSelectorAjax() Get ajax parameters to be used in setupSelect2, based on this.autocomplete Returns: to be passed in as the value for ajax in setupSelect2 Type object | null getDefaultPages() Get the pages that should be shown if none were requested in the URL Returns: promise resolving with the array of pages to be shown, based on project Type Deferred getEditData(pages) Query musikanimal API to get edit data about page within date range Parameters: Name Type Description pages Array page names Returns: Promise resolving with editing data Type Deferred getLangviewsURL(page) Link to /langviews for given page and chosen daterange Parameters: Name Type Description page String page title Returns: URL Type String getPageAndEditInfo(pages) Get page info and editing info of given pages. Also sets this.entityInfo Parameters: Name Type Description pages Array page names Returns: Promise resolving with this.entityInfo Type Deferred getParams( [specialRange]) Get all user-inputted parameters except the pages Parameters: Name Type Argument Default Description specialRange boolean &lt;optional&gt; true whether or not to include the special range instead of start/end, if applicable Returns: project, platform, agent, etc. Type Object getRedirectviewsURL(page) Link to /redirectviews for given page and chosen daterange Parameters: Name Type Description page String page title Returns: URL Type String getSearchParams(query) Construct query for API based on what type of search we're doing Parameters: Name Type Description query Object as returned from Select2 input Returns: query params to be handed off to API Type Object getSortProperty(item, type) Get value of given page for the purposes of column sorting in table view Parameters: Name Type Description item object page name type String type of property to get Returns: value Type String | Number initialize() Initialize the application. Called in pv.js after translations have loaded massviewsRedirectWithPagePile(pages) Create a PagePile with given pages using the API and redirect to Massviews. This is used when the user passes in more than 10 pages Parameters: Name Type Description pages Array pages to convert to a PagePile and open in Massviews Returns: promise resolved only if creation of PagePile failed Type Deferred popParams() Parses the URL query string and sets all the inputs accordingly Should only be called on initial page load, until we decide to support pop states (probably never) processInput( [force] [, removedPage]) Query the API for each page, building up the datasets and then calling renderData Parameters: Name Type Argument Description force boolean &lt;optional&gt; whether to force the chart to re-render, even if no params have changed removedPage string &lt;optional&gt; page that was just removed via Select2, supplied by select2:unselect handler Returns: Type null processSearchResults(data) Processes Mediawiki API results into Select2 format based on settings Parameters: Name Type Description data Object data as received from the API Returns: data ready to handed over to Select2 Type Object pushParams() Replaces history state with new URL query string representing current user input Called whenever we go to update the chart setupListeners() General place to add page-wide listeners setupSelect2() Sets up the article selector and adds listener to update chart showSinglePageLegend() Show info below the chart when there is only one page being queried updateTable() Update the page comparison table, shown below the chart Returns: Type null validateProject() Calls parent setupProjectInput and updates the view if validations passed reverting to the old value if the new one is invalid Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"Pv.html":{"id":"Pv.html","title":"Class: Pv","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: Pv Pv Pv class, contains code amongst all apps (Pageviews, Topviews, Langviews, Siteviews, Massviews, Redirect Views) new Pv(appConfig) Main constructor for each app, giving way to the parent constructor in list_helpers or chart_helpers Parameters: Name Type Description appConfig Object as defined in the app's config.js Members &lt;static&gt; multilangProjects List of valid multilingual projects colorsStyleEl create new stylesheet dateFormat Get date format to use based on settings daterangepicker Get the daterangepicker instance. Plain and simple. processStart :null|Date tracking of elapsed time Type: null | Date project Get the project name (without the .org) Methods addInvalidParamNotice(param) Add site notice for invalid parameter Parameters: Name Type Description param String name of parameter clearMessages() Clear inline messages used to show non-critical errors dbName(project) Get the database name of the given projet Parameters: Name Type Description project String with or without .org Returns: database name Type String downloadData(data, extension) Force download of given data, or open in a new tab if HTML5 download attribute is not supported Parameters: Name Type Description data String Raw data prepended with data type, e.g. &quot;data:text/csv;charset=utf-8,my data...&quot; extension String the file extension to use fetchSiteInfo(project) Get general information about a project, such as namespaces, title of the main page, etc. Data returned by the api is also stored in this.siteInfo Parameters: Name Type Description project String project such as en.wikipedia (with or without .org) Returns: promise resolving with siteinfo, along with any other cached siteinfo for other projects Type Deferred fillInSettings() Fill in values within settings modal with what's in the session object focusSelect2() Add focus to Select2 input field formatNumber(num) Format number based on current settings, e.g. localize with comma delimeters Parameters: Name Type Description num number | string number to format Returns: formatted number Type string formatYAxisNumber(num) show every other number in the y-axis, called from PvConfig Parameters: Name Type Description num Number numerical value Returns: formatted number or null if an even number Type String | null getBugReportURL( [phabPaste] [, titleOverride]) Get URL to file a report on Meta, preloaded with permalink Parameters: Name Type Argument Description phabPaste String &lt;optional&gt; URL to auto-generated error report on Phabricator titleOverride String &lt;optional&gt; goes in the title input field of the wiki editing interface Returns: URL Type String getDateHeadings(localized) Gets the date headings as strings - i18n compliant Parameters: Name Type Default Description localized boolean true whether the dates should be localized per browser language Returns: the date headings as strings Type Array getExpandedPageURL(page) Get the explanded wiki URL given the page name This should be used instead of getPageURL when you want to chain query string parameters Parameters: Name Type Description page string name Returns: URL for the page Type string getExportFilename() Get informative filename without extension to be used for export options Returns: filename without an extension Type string getFromLocalStorage(key) Get a value from localStorage, using a temporary storage if localStorage is not supported Parameters: Name Type Description key string key for the value to retrieve Returns: stored value Type Mixed getHistoryLink(page, content) Get full link to page history for given page and project Parameters: Name Type Description page string page to link to content string what to put as the link text Returns: HTML markup Type string getLocaleDateString() get date format for the browser's locale Returns: format to be passed to moment.format() Type String getPageInfo(pages) Get basic info on given pages, including the normalized page names. E.g. masculine versus feminine namespaces on dewiki Parameters: Name Type Description pages array array of page names Returns: promise with data fetched from API Type Deferred getPageLink(page [, project]) Get a full link for the given page and project Parameters: Name Type Argument Description page string page to link to project string &lt;optional&gt; project link, defaults to this.project Returns: HTML markup Type string getPageURL(page [, project]) Get the wiki URL given the page name Parameters: Name Type Argument Description page string page name project string &lt;optional&gt; project, or this.project (for chart-based apps) Returns: URL for the page Type string getSiteInfo(project) Helper to get siteinfo from this.siteInfo for given project, with or without .org Parameters: Name Type Description project String project name, with or without .org Returns: site information if present Type Object | undefined getSiteLink(site) Get the wiki URL given the page name Parameters: Name Type Description site string site name (e.g. en.wikipedia.org) Returns: URL for the site Type string getTopviewsMonth( [useStartDate]) Get month that would be shown in Topviews based on start date or end date, as specified Parameters: Name Type Argument Default Description useStartDate Boolean &lt;optional&gt; true if false, the end date will be used Returns: date within the month that will be used Type moment getTopviewsMonthURL(project [, month]) Link to /topviews for given project and chosen options Parameters: Name Type Argument Description project String project to link to month moment &lt;optional&gt; date that lies within the month we want to link to Returns: URL Type String getUserAgent() Get user agent, if supported Returns: user-agent Type string hashCode(str) Generate a unique hash code from given string Parameters: Name Type Description str String to be hashed Returns: the hash Type String isChartApp() Is this one of the chart-view apps (that does not have a list view)? Returns: true or false Type Boolean isListApp() Is this one of the list-view apps? Returns: true or false Type Boolean isMultilangProject() Test if the current project is a multilingual project Returns: is multilingual or not Type Boolean massApi(params, project [, continueKey] [, dataKey] [, limit]) Make mass requests to MediaWiki API The API normally limits to 500 pages, but gives you a 'continue' value to finish iterating through the resource. Parameters: Name Type Argument Default Description params Object parameters to pass to the API project String project to query, e.g. en.wikipedia (.org is optional) continueKey String &lt;optional&gt; continue the key to look in the continue hash, if present (e.g. cmcontinue for API:Categorymembers) dataKey String | function &lt;optional&gt; the key for the main chunk of data, in the query hash (e.g. categorymembers for API:Categorymembers) If this is a function it is given the response data, and expected to return the data we want to concatentate. limit Number &lt;optional&gt; max number of pages to fetch Returns: promise resolving with data Type Deferred n(value) Localize Number object with delimiters Parameters: Name Type Description value Number the Number, e.g. 1234567 Returns: with locale delimiters, e.g. 1,234,567 (en-US) Type string numDaysInRange() Compute how many days are in the selected date range Returns: number of days Type integer parseQueryString( [multiParam]) Generate key/value pairs of URL query string Parameters: Name Type Argument Description multiParam string &lt;optional&gt; parameter whose values needs to split by pipe character Returns: key/value pairs representation of query string Type Object patchUsage(app) Simple metric to see how many use it (pageviews of the pageview, a meta-pageview, if you will :) Parameters: Name Type Description app string one of: pv, lv, tv, sv, ms processEnded() Get elapsed time from this.processStart, and show it Returns: Elapsed time from this.processStart in milliseconds Type moment processStarted() Set timestamp of when process started Returns: start time Type moment rateLimit(fn, delay, context) Adapted from http://jsfiddle.net/dandv/47cbj/ courtesy of dandv Same as _.debounce but queues and executes all function calls Parameters: Name Type Description fn function function to debounce delay delay delay duration of milliseconds context object scope the function should refer to Returns: rate-limited function to call instead of your function Type function resetSelect2() Removes all Select2 related stuff then adds it back Also might result in the chart being re-rendered rgba(value, alpha) Change alpha level of an rgba value Parameters: Name Type Description value string rgba value alpha float | string transparency as float value Returns: rgba value Type string saveSetting(key, value) Save a particular setting to session and localStorage Parameters: Name Type Description key string settings key value string | boolean value to save saveSettings() Save the selected settings within the settings modal Prefer this implementation over a large library like serializeObject or serializeJSON setLocalStorage(key, value) Set a value to localStorage, using a temporary storage if localStorage is not supported Parameters: Name Type Description key string key for the value to set value Mixed value to store Returns: stored value Type Mixed setSelect2Defaults(items) Directly set items in Select2 Currently is not able to remove underscores from page names Parameters: Name Type Description items array page titles Returns: untouched array of items Type array setSpecialRange(type) Sets the daterange picker values and this.specialRange based on provided special range key WARNING: not to be called on daterange picker GUI events (e.g. special range buttons) Parameters: Name Type Description type string one of special ranges defined in this.config.specialRanges, including dynamic latest range, such as latest-15 for latest 15 days Returns: updated this.specialRange object or null if type was invalid Type object | null setupDateRangeSelector() sets up the daterange selector and adds listeners setupListeners() Cross-application listeners Each app has it's own setupListeners() that should call super.setupListeners() setupSelect2Colors() Setup colors for Select2 entries so we can dynamically change them This is a necessary evil, as we have to mark them as !important and since there are any number of entires, we need to use nth-child selectors Returns: our new stylesheet Type CSSStylesheet setupSettingsModal() Set values of form based on localStorage or defaults, add listeners showFatalErrors(errors) Loop through given errors and show them to the user, also creating a paste on phabricator Parameters: Name Type Description errors Array list of error messages (strings) splash() Splash in console, just for fun startSpinny() Add the loading indicator class and set the safeguard timeout stopSpinny() Remove loading indicator class and clear the safeguard timeout toast(opts) Add a site notice (Bootstrap alert) Parameters: Name Type Description opts Object as follows: { message: '', // {String} message - message to show level: 'warning', // one of 'success', 'info', 'warning', 'error' timeout: 10, // {Number} [timeout] - in seconds. Use 0 to show indefinitely title: '' // {String} [title] - will appear in bold and in front of the message } toastError(message [, timeout]) Show an error to user via this.toast Parameters: Name Type Argument Default Description message String timeout Number &lt;optional&gt; 10 in seconds toastInfo(message [, timeout]) Show info message to user via this.toast Parameters: Name Type Argument Default Description message String timeout Number &lt;optional&gt; 10 in seconds toastSuccess(message [, timeout]) Show success message to user via this.toast Parameters: Name Type Argument Default Description message String timeout Number &lt;optional&gt; 10 in seconds toastWarn(message [, timeout]) Show warning to user via this.toast Parameters: Name Type Argument Default Description message String timeout Number &lt;optional&gt; 10 in seconds underscorePageNames(pages) Replace spaces with underscores Parameters: Name Type Description pages array array of page names Returns: page names with underscores Type array updateInterAppLinks() Update hrefs of inter-app links to load currently selected project validateDateRange(params) Validate the date range of given params and throw errors as necessary and/or set defaults Parameters: Name Type Description params Object as returned by this.parseQueryString() Returns: true if there were no errors, false otherwise Type Boolean validateParams(params) Validate basic params against what is defined in the config, and if they are invalid set the default Parameters: Name Type Description params Object params as fetched by this.parseQueryString() Returns: same params with some invalid parameters correted, as necessary Type Object validateProject( [multilingual]) Adds listeners to the project input for validations against the site map, reverting to the old value if the new one is invalid Parameters: Name Type Argument Default Description multilingual Boolean &lt;optional&gt; false whether we should check if it is a multilingual project Returns: whether or not validations passed Type Boolean writeMessage(message [, clear]) Writes message just below the chart or list of data Parameters: Name Type Argument Default Description message string message to write clear boolean &lt;optional&gt; false whether to clear any existing messages Returns: jQuery object of message container Type jQuery Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"PvConfig.html":{"id":"PvConfig.html","title":"Class: PvConfig","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: PvConfig PvConfig Configuration for all Pageviews applications. Some properties may be overriden by app-specific configs new PvConfig() set instance variable (config), also defining any private methods Members circularTooltips Get config for tooltips shown on circular charts, used by Chart.js Methods linearTooltips( [mode]) Get config for tooltips shown on linear charts, used by Chart.js Parameters: Name Type Argument Description mode String &lt;optional&gt; x-axis or label depending on chart type Returns: Type Object Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"RedirectViews.html":{"id":"RedirectViews.html","title":"Class: RedirectViews","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: RedirectViews RedirectViews Main RedirectViews class new RedirectViews() set instance variables and boot the app via pv.constructor Members baseProject Get the base project name (without language and the .org) outputData datasets structure: [{ title: page, items: [ { access: '', agent: '', article: '', granularity: '', project: '', timestamp: '', views: 10 } ] }] output structure: { labels: [''], listData: [ { label: '', data: [1,2,3,4], sum: 10, average: 2, index: 0 ... MERGE in this.config.chartConfig[this.chartType].dataset(this.config.colors[0]) } ], totalViewsSet: [1,2,3,4], sum: 10, average: 2, datesWithoutData: ['2016-05-16T00:00:00-00:00'] } typeahead Get instance of Typeahead plugin Methods assignDefaults() Copy necessary default values to class instance. Called when the view is reset. buildMotherDataset(label, link, datasets) Build our mother data set, from which we can draw a chart, render a list of data, whatever our heart desires :) Parameters: Name Type Description label string label for the dataset link string HTML anchor tag for the label datasets array array of datasets for each article, as returned by the Pageviews API Returns: mother data set, also stored in this.outputData Type object exportCSV() Exports current lang data to CSV format and loads it in a new tab With the prepended data:text/csv this should cause the browser to download the data getExportFilename() Get informative filename without extension to be used for export options Returns: filename without an extension Type string getPageViewsData(redirectData) Loop through given pages and query the pageviews API for each Also updates this.outputData with result Parameters: Name Type Description redirectData Array as given by the getRedirects promise Returns: Promise resolving with data ready to be rendered to view Type Deferred getParams( [forCacheKey]) Get all user-inputted parameters Parameters: Name Type Argument Default Description forCacheKey boolean &lt;optional&gt; false whether or not to exclude sort, direction and other parameters irrelevant to the query in the returned object. This is for the purposes of generating a unique cache key for params affecting the API queries Returns: project, platform, agent, etc. Type Object getRedirects(pageName) Get all redirects of a page Parameters: Name Type Description pageName String name of page we want to get data about Returns: Promise resolving with redirect data Type Deferred getSortProperty(item, type) Get value of given langview entry for the purposes of column sorting Parameters: Name Type Description item object langview entry within this.outputData type String type of property to get Returns: value Type String | Number initialize() Initialize the application. Called in pv.js after translations have loaded popParams() Parses the URL query string and sets all the inputs accordingly Should only be called on initial page load, until we decide to support pop states (probably never) processInput() Process the redirectviews for the article and options entered Called when submitting the form Returns: Type null pushParams(clear) Push relevant class properties to the query string Parameters: Name Type Default Description clear Boolean false wheter to clear the query string entirely Returns: Type null renderData() Render list of redirectviews into view setState(state) Helper to set a CSS class on the main node, styling the document based on a 'state' Parameters: Name Type Description state String class to be added; should be one of ['initial', 'processing', 'complete'] setupListeners() Add general event listeners setupSourceInput() Setup typeahead on the article input, killing the prevous instance if present validateProject() Calls parent setupProjectInput and updates the view if validations passed reverting to the old value if the new one is invalid Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"SiteViews.html":{"id":"SiteViews.html","title":"Class: SiteViews","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: SiteViews SiteViews Main SiteViews class new SiteViews() Set instance variables and boot the app via pv.constructor Methods getParams( [specialRange]) Get all user-inputted parameters except the sites Parameters: Name Type Argument Default Description specialRange boolean &lt;optional&gt; true whether or not to include the special range instead of start/end, if applicable Returns: platform, agent, etc. Type Object getSiteStats(sites) Get statistics for the given sites Parameters: Name Type Description sites Array site names, ['en.wikipedia.org', 'fr.wikipedia.org', ...] Returns: Promise resolving with the stats for each site Type Deferred getSortProperty(item, type) Get value of given page for the purposes of column sorting in table view Parameters: Name Type Description item object page name type String type of property to get Returns: value Type String | Number initialize() Initialize the application. Called in pv.js after translations have loaded popParams() Parses the URL query string and sets all the inputs accordingly Should only be called on initial page load, until we decide to support pop states (probably never) processInput(force [, removedSite]) Query the API for each site, building up the datasets and then calling renderData Parameters: Name Type Argument Description force boolean whether to force the chart to re-render, even if no params have changed removedSite string &lt;optional&gt; site that was just removed via Select2, supplied by select2:unselect handler Returns: Type null pushParams() Push relevant class properties to the query string Called whenever we go to update the chart setPlatformOptionValues() Set options for the Platform dropdown based on whether we're showing pageviews or unique devices setupDataSourceSelector() Setup listeners for the data source selector, and initialize values for the platform dropdown setupListeners() General place to add page-wide listeners setupSelect2() Sets up the site selector and adds listener to update chart showSinglePageLegend() Show info below the chart when there is only one site being queried updateTable() Update the page comparison table, shown below the chart Returns: Type null validateParams(params) Extends super.validateParams to handle special conditional params specific to Siteviews Parameters: Name Type Description params Object params as fetched by this.parseQueryString() Returns: same params with some invalid parameters correted, as necessary Type Object validateProjects(projects) Validates the given projects against the site map showing an error message of any that are invalid, and returning an array of the given projects that are valid Parameters: Name Type Description projects Array array of project strings to validate Returns: given projects that are valid Type Array Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "},"TopViews.html":{"id":"TopViews.html","title":"Class: TopViews","body":" Documentation Classes LangViewsMassViewsMetaViewsMixinBuilderPageViewsPvPvConfigRedirectViewsSiteViewsTopViews Global ChartHelpersconfigListHelperssiteMaptemplatesundefinedassignOutputDataChartOptsundefinedbuildChartDataundefineddestroyChartundefinedexportCSVundefinedexportJSONundefinedexportPNGundefinedfillInZerosundefinedgetApiUrlundefinedgetCacheKeyundefinedgetPageViewsDataundefinedgetPageviewsURLundefinedgetPermaLinkundefinedgetStateundefinedisLogarithmicundefinedisLogarithmicCapableundefinedisPageviewsundefinedisRequestCachedundefinedisUniqueDevicesundefinedprintChartundefinedrenderDataundefinedresetViewundefinedsetChartPointDetectionRadiusundefinedsetColorsAndLogValuesundefinedsetInitialChartTypeundefinedsetupDateRangeSelectorundefinedshouldBeLogarithmicundefinedshowErrorsundefinedshowPointLabelsundefinedtoggleViewundefinedupdateChartundefinedupdateProgressBar Class: TopViews TopViews Main TopViews class new TopViews() Set instance variables and boot the app via pv.constructor Members dateFormat Get date format to use based on settings datepicker Get instance of datepicker pageNames build the pageNames array for Select2 Methods addExclude(pages [, triggerChange]) Add given page(s) to list of excluded pages and optionally re-render the view Parameters: Name Type Argument Default Description pages Array | String page(s) to add to excludes triggerChange Boolean &lt;optional&gt; true whether or not to re-render the view addExcludeListeners() Re-add listeners to exclude pages, called after sorting or changing params clearSearch() Clear the topviews search drawData() Print list of top pages exportCSV() Exports current chart data to CSV format and loads it in a new tab With the prepended data:text/csv this should cause the browser to download the data exportJSON() Exports current chart data to JSON format and loads it in a new tab filterOutNamespace(pages [, restrictedNamespace]) Get the pages that are not in the given namespace Parameters: Name Type Argument Default Description pages array pages to filter restrictedNamespace Number &lt;optional&gt; 0 ID of the namespace to restrict to, defaults to 0 (mainspace) Returns: promise resolving with pages in given namespace Type Deferred fixLegacyDates(params) Fix legacy links to Topviews that used a defined date range. Instead, we'll determine how wide the range is, and if it's greater than 3 days then use the month, otherwise use the first day of the range Parameters: Name Type Description params Object params as provided by this.parseQueryString Returns: modified params with corrected dates Type Object getAPIDate() Get the currently selected date for the purposes of pageviews API call Returns: formatted date Type String getExportFilename() Get informative filename without extension to be used for export options Returns: filename without an extension Type string getPageviewsURL(article) Link to /pageviews for given article and chosen daterange Parameters: Name Type Description article string page name Returns: URL Type string getParams( [specialRange]) Get all user-inputted parameters except the pages Parameters: Name Type Argument Default Description specialRange boolean &lt;optional&gt; true whether or not to include the special range instead of start/end, if applicable Returns: project, platform, excludes, etc. Type Object getPermaLink() Get params needed to create a permanent link of visible data Returns: hash of params Type Object initData() Fetch data from API Returns: promise with data Type Deferred initialize() Initialize the application. Called in pv.js after translations have loaded isMonthly() Are we in 'monthly' mode? (If we aren't then we're in daily) Returns: yes or no Type Boolean popParams() Parses the URL query string and sets all the inputs accordingly Should only be called on initial page load, until we decide to support pop states (probably never) processInput(force) Apply user input by updating the URL query string and view, if needed Parameters: Name Type Description force boolean apply all user options even if we've detected nothing has changed Returns: deferred object from initData Type Deferred pushParams() Replaces history state with new URL query string representing current user input Called whenever we go to update the chart resetSelect2() Removes all Select2 related stuff then adds it back resetView( [clearSelector]) Removes chart, messages, and resets Select2 selections Parameters: Name Type Argument Default Description clearSelector Boolean &lt;optional&gt; true whether to clear the Select2 control searchTopviews() Search the topviews data for the given page title and restrict the view to the matches Returns: Type null setDate(dateInput) Set datepicker based on provided date or range Parameters: Name Type Description dateInput String either a range like 'last-month', 'yesterday' or date with format 'YYYY-MM-DD' Returns: Type null setSelect2Defaults(pages) Directly set pages in Select2 selector Currently is not able to remove underscore from page names Parameters: Name Type Description pages array page titles Returns: untouched array of pages Type array setSpecialRange(range) Set datepicker based on provided relative range Parameters: Name Type Description range String e.g. 'last-month', 'yesterday' Returns: whether a valid range was provided and was set Type Boolean setupDateRangeSelector( [type]) sets up the datepicker based on given type Parameters: Name Type Argument Default Description type String &lt;optional&gt; monthly either 'monthly' or 'daily' setupListeners() General place to add page-wide listeners setupSelect2(excludes) Sets up the Select2 selector and adds listener to update chart Parameters: Name Type Description excludes array default page names to exclude startSpinny() Add the loading indicator class and set the safeguard timeout stopSpinny(hideDataLinks) Remove loading indicator class and clear the safeguard timeout Parameters: Name Type Description hideDataLinks Boolean whether or not to hide the data links validateProject() Calls parent setupProjectInput and updates the view if validations passed reverting to the old value if the new one is invalid Ã— Search results Close Documentation generated by JSDoc 3.4.2 on November 26th 2016, 1:59:37 pm using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
